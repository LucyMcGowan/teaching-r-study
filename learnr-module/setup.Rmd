```{r load-packages, include = FALSE}
library(learnr)
library(gradethis)
library(tidyverse)
library(rdrop2)
library(glue)
library(praise)
library(shinysurveys)
```

## Learning Objectives

After completing this tutorial, you should be able to:

1.  Understand various data structures in R
2.  Read data into R
3.  Manipulate and summarize data
4.  Extract information from summarized data to answer analysis questions

You will see similar information presented two different ways and will complete three short assessments.

## Assessments

There are three assessments, one before you being, one after the first section, and one at the end. These have the same questions. You are welcome to use any techniques to answer these questions. If you don't know how to answer any, don't worry - you can skip to the next topic by clicking "Next Topic".

```{r, echo = FALSE}
question_ui_initialize.numeric <- function(question, value, ...) {
  choice_names <- learnr:::answer_labels(question)
  choice_values <- learnr:::answer_values(question)
  numericInput(question$id$answer, label = question$question,
               value = NA,
               min = min(as.numeric(choice_values)),
               max = max(as.numeric(choice_values)))
}

question_ui_completed.numeric <- function(question, value, ...) {
  disable_all_tags(
    numericInput(question$id$answer,
                 label = question$question,
                 value = value
    )
  )
}

question_is_correct.always_correct <- function(question, value, ...) {
  return(mark_as(TRUE, message = NULL))
}
```

```{r setup, include=FALSE}

learnr::tutorial_options(exercise.checker = gradethis::grade_learnr)
rdrop2::drop_auth(rdstoken = "token.rds")

tutorial_event_recorder <- function(username) {

  recorder <- function(tutorial_id, tutorial_version, user_id,
                       event, data) {
    if (rdrop2::drop_exists(glue::glue("/D'Agostino McGowan Data Science Lab/learnr_results/data_{username}.rds"))) {
      rdrop2::drop_download(path = glue::glue("/D'Agostino McGowan Data Science Lab/learnr_results/data_{username}.rds"),
                    local_path = glue::glue("data_{username}.rds"),
                    overwrite = TRUE)
      t <- readRDS(glue::glue("data_{username}.rds"))
    } else {
      t <- tibble::tibble(
        username = username,
        time = .POSIXct(numeric(0)),
        tutorial_id = character(),
        tutorial_version = character(),
        user_id = character(),
        event = character(),
        data = list())

    }
    t <- dplyr::bind_rows(t,
                   tibble::tibble(
                     username = username,
                     time = Sys.time(),
                     tutorial_id = tutorial_id,
                     tutorial_version = tutorial_version,
                     user_id = user_id,
                     event = event,
                     data = list(data)
                   )
    )
    saveRDS(t, file = glue::glue("data_{username}.rds"))
    rdrop2::drop_upload(file = glue::glue("data_{username}.rds"),
                path = "/D'Agostino McGowan Data Science Lab/learnr_results/")
  }
  recorder
}

```

```{r, echo = FALSE, context = "server"}

observe({
query <- shiny::parseQueryString(session$clientData$url_search)

if (!base::is.null(query[["user_id"]])) {
  user_id <- shinysurveys:::base_extract_user_id(query)
    
} else {
  user_id <- "NO_USERNAME"
}

options(tutorial.event_recorder = tutorial_event_recorder(username = user_id))

})


```
